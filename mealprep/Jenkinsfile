node {
  def app
  
  stage('Clone Repository') {
    checkout scm
  }
  
  stage('Build image') {
    app = docker.build("nodeapp", "./mealprep/")
  }
  
  stage('Push image to ECR') {
    docker.withRegistry(
      'https://431260421084.dkr.ecr.us-east-2.amazonaws.com',
      'ecr:us-east-2:gdp.aws.credentials'){
      app.push('latest')
    }
  }
  
  stage('Pull image to EC2') {
    sshagent(credentials : ['c38af766-d84e-4ca2-9170-6d9b180c33e1'] {
      sh "echo pwd"
    }
  }
}
