node {
  def app
  
  stage('Clone Repository') {
    checkout scm
  }
  
  stage('Build image') {
    app = docker.build("nodeapp", "./mealprep/")
  }
  
  stage('Push image') {
    steps{
      script{
        docker.withRegistry(
          'https://431260421084.dkr.ecr.us-east-2.amazonaws.com/gdp_docker_repository',
          'ecr:us-east-2:gdp.aws.credentials'){
          app.push('latest')
        }
      }
    }
  }
}
